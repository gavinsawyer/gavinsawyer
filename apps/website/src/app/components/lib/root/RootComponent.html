<!--
  ~ Copyright Â© 2025 Gavin Sawyer. All rights reserved.
  -->

<div
  class="harness"
  (click)="$event.stopPropagation();"
  (keydown)="$event.key === 'Escape' || $event.stopPropagation();"
  tabindex="-1">
  <div class="between"><ng-container *ngTemplateOutlet="contentTemplate" /></div>
</div>

<bowstring--sheet #localeSheetComponent>
  @defer {<bowstring--header>
    <h6 i18n>Select your locale.</h6>
  </bowstring--header>
  <bowstring--divider />
  <bowstring--section>
    @for (_projectLocaleId of projectLocaleIds //noinspection UnusedLocalSymbols; track $index) {<bowstring--button
      [disabled]="projectLocaleIds[$index] === projectLocaleId"
      level="2"
      (output)="projectLocaleIds[$index] === projectLocaleId || changeLocale(projectLocaleIds[$index]);">
      <bowstring--symbol input="Globe" />
      <bowstring--label [input]="localeDisplayNames[projectLocaleIds[$index]]" />
    </bowstring--button>}
  </bowstring--section>}
</bowstring--sheet>
<bowstring--sheet #versionSheetComponent>
  @defer {<bowstring--heading-group>
    <bowstring--header>
      <h6 style="/*noinspection CssNoGenericFontName,CssUnresolvedCustomProperty*/font-family: Anybody, var(--bowstring--root--brand-font-family); font-weight: 300;"><bowstring--logo inline /> {{ packageVersion.split(" Beta ")[0] }}</h6>
    </bowstring--header>
    <bowstring--caption>
      <bowstring--flexbox-container flexDirection="row">
        @if (packageVersion.split(" Beta ")[1]; as beta) {<span>Beta&nbsp;{{ beta }}</span>}
        <span>Commit&nbsp;&num;<bowstring--link
          inline
          [url]="'https://github.com/gavinsawyer/gavinsawyer/commit/' + gitInfoPartial.hash">{{ gitInfoPartial.hash }}</bowstring--link></span>
        <span>{{ projectName | titlecase }}</span>
      </bowstring--flexbox-container>
    </bowstring--caption>
  </bowstring--heading-group>
  <bowstring--divider />
  <bowstring--section>
    <bowstring--button
      level="2"
      url="https://github.com/gavinsawyer/gavinsawyer/issues/new">
      <bowstring--symbol input="ExclamationmarkBubbleFill" />
      <bowstring--label
        i18n-input
        input="Send feedback" />
    </bowstring--button>
  </bowstring--section>}
</bowstring--sheet>

<ng-template #contentTemplate>
  <bowstring--main>
    @if (bannerTemplateRef$(); as bannerTemplateRef) {<ng-container *ngTemplateOutlet="bannerTemplateRef" />}
    <bowstring--flexbox-container
      alignItems="last baseline"
      flexDirection="row"
      flexWrap="wrap"
      gapColumn="calc(var(--bowstring--root--gap-column) * pow(var(--phi), -1))"
      gapRow="calc(var(--bowstring--root--gap-row) * pow(var(--phi), -1))"
      justifyContent="space-between">
      <bowstring--header fontSizeExponent="-3">
        <h1 style="/*noinspection CssNoGenericFontName,CssUnresolvedCustomProperty*/font-family: var(--bowstring--root--brand-font-family); font-weight: 900; font-variation-settings: 'wdth' 112.5;">
          <bowstring--link
            exact
            url="/">
            <bowstring--label [input]="brandLib.title" />
          </bowstring--link>
        </h1>
      </bowstring--header>
      @if ((projectRoutes | bowstringFindRouteByPath:'gallery') || (projectRoutes | bowstringFindRouteByPath:'shop') || (projectRoutes | bowstringFindRouteByPath:'account') || projectRoutes.slice(1).slice(0, -3).length) {<bowstring--nav>
        @if (projectRoutes | bowstringFindRouteByPath:'gallery'; as route) {<bowstring--link [url]="'/' + route.path">
          <bowstring--label [input]="route.data?.['title']" />
        </bowstring--link>}
        @if (projectRoutes | bowstringFindRouteByPath:'shop'; as route) {<bowstring--link [url]="'/' + route.path">
          <bowstring--label [input]="route.data?.['title']" />
        </bowstring--link>}
        @for (route of projectRoutes.slice(1).slice(0, -3); track $index) {<bowstring--link [url]="'/' + route.path">
          <bowstring--label [input]="route.data?.['title']" />
        </bowstring--link>}
        @if (projectRoutes | bowstringFindRouteByPath:'account'; as route) {<bowstring--link [url]="'/' + route.path">
          <bowstring--label [input]="route.data?.['title']" />
        </bowstring--link>}
      </bowstring--nav>}
    </bowstring--flexbox-container>
    <router-outlet />
    @if (aboveTemplateRef$(); as aboveTemplateRef) {<bowstring--above>
      <ng-container *ngTemplateOutlet="aboveTemplateRef" />
    </bowstring--above>}
  </bowstring--main>
  @defer {@if (belowTemplateRef$(); as belowTemplateRef) {<bowstring--below>
    <ng-container *ngTemplateOutlet="belowTemplateRef" />
  </bowstring--below>}}
  <bowstring--footer>
    <bowstring--header>
      <h6 style="/*noinspection CssNoGenericFontName,CssUnresolvedCustomProperty*/font-family: var(--bowstring--root--brand-font-family); font-weight: 900; font-variation-settings: 'wdth' 112.5;">
        <bowstring--link
          exact
          url="/">
          <bowstring--label [input]="brandLib.title" />
        </bowstring--link>
      </h6>
    </bowstring--header>
    <bowstring--section
      flexDirection="row"
      flexWrap="wrap"
      justifyContent="space-between">
      <bowstring--flexbox-container flexDirection="row">
        @if ((projectRoutes | bowstringFindRouteByPath:'gallery') || (projectRoutes | bowstringFindRouteByPath:'shop') || projectRoutes.slice(1).slice(0, -3).length) {<bowstring--flexbox-container alignItems="flex-start">
          @if (projectRoutes | bowstringFindRouteByPath:'gallery'; as route) {<bowstring--link [url]="'/' + route.path">
            <bowstring--label [input]="route.data?.['title']" />
          </bowstring--link>}
          @if (projectRoutes | bowstringFindRouteByPath:'shop'; as route) {<bowstring--link [url]="'/' + route.path">
            <bowstring--label [input]="route.data?.['title']" />
          </bowstring--link>}
          @for (route of projectRoutes.slice(1).slice(0, -3); track $index) {<bowstring--link [url]="'/' + route.path">
            <bowstring--label [input]="route.data?.['title']" />
          </bowstring--link>}
        </bowstring--flexbox-container>}
        <bowstring--flexbox-container alignItems="flex-start">
          @if (projectRoutes | bowstringFindRouteByPath:'privacy'; as route) {<bowstring--link [url]="'/' + route.path">
            <bowstring--label [input]="route.data?.['title']" />
          </bowstring--link>}
          @if (projectRoutes | bowstringFindRouteByPath:'terms'; as route) {<bowstring--link [url]="'/' + route.path">
            <bowstring--label [input]="route.data?.['title']" />
          </bowstring--link>}
        </bowstring--flexbox-container>
      </bowstring--flexbox-container>
      <bowstring--flexbox-container flexDirection="row">
        <bowstring--flexbox-container alignItems="flex-start">
          <bowstring--link url="https://github.com/gavinsawyer">
            <bowstring--symbol input="ArrowUpForwardAppFill" />
            <bowstring--label input="GitHub" />
          </bowstring--link>
          <bowstring--link url="https://www.linkedin.com/in/gavinsawyer-us">
            <bowstring--symbol input="ArrowUpForwardAppFill" />
            <bowstring--label input="LinkedIn" />
          </bowstring--link>
        </bowstring--flexbox-container>
      </bowstring--flexbox-container>
    </bowstring--section>
    <bowstring--divider />
    <bowstring--section id="connectivitySection"
      flexDirection="row"
      flexWrap="wrap">
      <div [hidden]="connectivityService.connected$()">
        <bowstring--link disabled>
          <bowstring--symbol input="NetworkSlash" />
          <bowstring--label
            i18n-input
            input="Disconnected" />
        </bowstring--link>
      </div>
      <div [hidden]="!connectivityService.connected$()">
        <bowstring--link disabled>
          <bowstring--symbol input="Network" />
          <bowstring--label
            i18n-input
            input="Connected" />
        </bowstring--link>
      </div>
    </bowstring--section>
    <bowstring--section id="informationAndOptionsSection"
      flexDirection="row"
      flexWrap="wrap"
      justifyContent="center">
      <bowstring--flexbox-container
        flexDirection="row"
        flexGrow="1"
        flexWrap="wrap">
        <span style="white-space: nowrap;">&copy;&nbsp;<div id="copyrightYear">2025&nbsp;</div><bowstring--link
          inline
          [url]="brandLib.copyrightHolderUrl">
          <bowstring--label [input]="brandLib.copyrightHolder" />
        </bowstring--link></span>
        <span style="white-space: nowrap;">&num;<bowstring--link
          [disabled]="versionSheetComponent.openModelWithTransform$()"
          inline
          (output)="versionSheetComponent.openModel$.set(true);">
          <bowstring--label [input]="gitInfoPartial.hash || ''" />
        </bowstring--link></span>
      </bowstring--flexbox-container>
      <bowstring--flexbox-container
        flexDirection="row"
        justifyContent="center">
        <bowstring--link
          [disabled]="localeSheetComponent.openModelWithTransform$()"
          (output)="localeSheetComponent.openModel$.set(true);">
          <bowstring--symbol input="Globe" />
          <bowstring--label [input]="localeDisplayNames[projectLocaleId]" />
        </bowstring--link>
      </bowstring--flexbox-container>
    </bowstring--section>
  </bowstring--footer>
  @if (errorsService.errors$(); as errors) {<bowstring--errors-container>
    @for (error of errors; track $index) {<bowstring--error
      level="2"
      open>{{ error }}</bowstring--error>}
  </bowstring--errors-container>}
</ng-template>
